
<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>Aplikasi OCR</title>

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
</head>
<body class="hold-transition sidebar-mini layout-navbar-fixed">
<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="/home" class="nav-link">Home</a>
      </li>
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
      <!-- Messages Dropdown Menu -->
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
			<!-- Brand Logo -->
			<a href="../../index3.html" class="brand-link"> <img
				src="../../dist/img/AdminLTELogo.png" alt="AdminLTE Logo"
				class="brand-image img-circle elevation-3" style="opacity: .8">
				<span class="brand-text font-weight-light">Aplikasi OCR</span>
			</a>

			<!-- Sidebar -->
			<div class="sidebar">
				<!-- Sidebar user (optional) -->
<!--				<div class="user-panel mt-3 pb-3 mb-3 d-flex">-->
<!--					<div class="image">-->
<!--						<img src="../../dist/img/user2-160x160.jpg"-->
<!--							class="img-circle elevation-2" alt="User Image">-->
<!--					</div>-->
<!--					<div class="info">-->
<!--						<a href="#" class="d-block">Doni Dera Wibisana</a>-->
<!--					</div>-->
<!--				</div>-->

				<!-- Sidebar Menu -->
				<nav class="mt-2">
					<ul class="nav nav-pills nav-sidebar flex-column"
						data-widget="treeview" role="menu" data-accordion="false">
						<!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
						<li class="nav-item has-treeview menu-open"><a href="#"
							class="nav-link active"> <i class="nav-icon fas fa-th"></i>
								<p>
									Setting <i class="fas fa-angle-left right"></i>
								</p>
						</a>
							<ul class="nav nav-treeview">
<!--								<li class="nav-item"><a href="/formbiodata"-->
<!--									class="nav-link"> <i class="far fa-circle nav-icon"></i>-->
<!--										<p>Form Biodata</p>-->
<!--								</a></li>-->
								<li class="nav-item"><a href="/editpath"
									class="nav-link"> <i class="far fa-circle nav-icon"></i>
										<p>Edit Folder Path</p>
								</a></li>
                                <li class="nav-item"><a href="/setting"
                                                        class="nav-link"> <i class="far fa-circle nav-icon"></i>
                                    <p>Edit Scheduler</p>
                                </a></li>
<!--								<li class="nav-item"><a href="/tabelbiodata"-->
<!--									class="nav-link"> <i class="far fa-circle nav-icon"></i>-->
<!--										<p>Tabel Biodata</p>-->
<!--								</a></li>-->
							</ul></li>
					</ul>
				</nav>
				<!-- /.sidebar-menu -->
			</div>
			<!-- /.sidebar -->
		</aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0 text-dark">Selamat Datang di Aplikasi OCR</h1>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <div class="content">
      <div class="container-fluid">

              <div class="card card-primary">
                  <div class="card-header">
                      <h3 class="card-title">Scan Dokumen</h3>
                  </div>
                  <br>
                  <div class="card-body table-responsive">

                          <div class="col-12" align="left">
                              <form id="file-upload-form">
                                  <label for="file-upload-input">Pilih file untuk di upload</label> <br>
                                  <input type="file" id="file-upload-input" name="file">
                                  <button type="submit" class="btn btn-primary">Upload</button>
                              </form>
<!--                              <p id="f1_upload_process">Loading...<br/><img src="loader.gif" /></p>-->
<!--                              <p id="result"></p>-->
<!--                              <form action="upload.php" method="post" enctype="multipart/form-data" target="upload_target" onsubmit="startUpload();" >-->
<!--                                  File: <input name="myfile" type="file" />-->
<!--                                  <input type="submit" name="submitBtn" value="Upload" />-->
<!--                              </form>-->

<!--                              <iframe id="upload_target" name="upload_target" src="#" style="width:0;height:0;border:0px solid #fff;"></iframe>-->
                          </div>
                          <div class="col-12" align="right">
                              <button type="button"
                                      class="btn btn-primary" id="proses">Process from Upload</button>
                              <button type="button"
                                      class="btn btn-primary" id="proses2">Process from Folder</button>
                          </div>

                      <br>
                      <table class="table table-striped table-bordered table-hover" id="tabelmu"
                             style="width:100%">
                      </table>
                      <br>
                      <table class="table table-striped table-bordered table-hover" id="tabelku"
                             style="width:100%">
                      </table>
                  </div>
              </div>

      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
    <div class="p-3">
      <h5>Title</h5>
      <p>Sidebar content</p>
    </div>
  </aside>
  <!-- /.control-sidebar -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <!-- To the right -->
    <div class="float-right d-none d-sm-inline">
      Anything you want
    </div>
    <!-- Default to the left -->
    <strong>Copyright &copy; 2014-2019 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved.
  </footer>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">Lihat Data</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

                </div>
                <div class="modal-body">
                    <h3 id="jumlahorang">Data tidak ditemukan</h3>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal 2 -->
    <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel2">Preview</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

                </div>
                <div class="modal-body">
<!--                    <img id="profileImage" src="" style='width:100%;' border="0">-->
                    <embed id="profileImage" src="" width="500" height="500">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.min.js"></script>
<!-- DataTables -->
<script src="../../plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../../plugins/datatables-bs4/js/dataTables.bootstrap4.js"></script>
<script src="../../plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="../../plugins/datatables-responsive/js/responsive.bootstrap4.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script>
        $("#proses").click(function() {

            $.ajax({
                type: 'GET',
                url: '/scan',
                success: function () {
                    console.log("test");
                    window.location.reload();
                }
            });

            swal({
                title: "Loading...",
                text: "Please wait...",
                type: "success",
                buttons: false,
                closeOnClickOutside: false,
                timer: 200000
            });
        })
    </script>

    <script>
        $("#proses2").click(function() {

            $.ajax({
                type: 'GET',
                url: '/scanFolder',
                success: function () {
                    window.location.reload();
                }
            });

            swal({
                title: "Loading...",
                text: "Please wait...",
                type: "success",
                buttons: false,
                closeOnClickOutside: false,
                timer: 200000
            });
        })
    </script>

    <script>
        $(document).ready(function () {
            // bind form submit event
            $("#file-upload-form").on("submit", function (e) {

                // cancel the default behavior
                e.preventDefault();

                // use $.ajax() to upload file
                $.ajax({
                    url: "/upload",
                    type: "POST",
                    data: new FormData(this),
                    enctype: 'multipart/form-data',
                    processData: false,
                    contentType: false,
                    cache: false,
                    success: function () {
                        swal({
                                title: "Uploaded!",
                                text: "File berhasil diupload",
                                type: "success",
                                buttons: false,
                                closeOnClickOutside: false,
                                timer: 2000
                            });
                        if ($.fn.DataTable.isDataTable('#tabelmu')) {
                            //table yg sudah dibentuk menjadi datatable harus d rebuild lagi untuk di instantiasi ulang
                            $('#tabelmu').DataTable().clear();
                            $('#tabelmu').DataTable().destroy();
                        }
                        $.ajax({
                            type: 'GET',
                            url: '/false',
                            success: function (datatable) {
                                $('#tabelmu').DataTable({
                                    data: datatable,
                                    "columns": [
                                        {
                                            title: "Nama File",
                                            data: 'docName'
                                        }
                                    ]
                                });
                            }
                        });
                    },
                    error: function (err) {
                        console.error(err);
                    }
                });
            });
        });
    </script>

    <script>
        function lihatData(id) {
            $('#myModal').modal('show');
            $.ajax({
                type: 'GET',
                url: '/get/' + id,
                success: function (hasil) {
                    if (hasil.length > 0) {
                        $('#jumlahorang').html(hasil);
                    } else {
                        $('#jumlahorang').html("Hasil tidak ditemukan");
                    }
                }
            });
        }
    </script>

    <script>
        function fixData(id) {
            $('#myModal').modal('show');
            $.ajax({
                type: 'GET',
                url: '/fix/' + id,
                success: function (hasil) {
                    if (hasil.length > 0) {
                        $('#jumlahorang').html(hasil);
                    } else {
                        $('#jumlahorang').html("Hasil tidak ditemukan");
                    }
                }
            });
        }
    </script>

    <script>
        function deleteData(id) {
            $.ajax({
                type: 'DELETE',
                url: '/delete/' + id,
                success: function (hasil) {
                    swal({
                        title: "Deleted!",
                        text: "Berhasil hapus data",
                        type: "success",
                        buttons: false,
                        closeOnClickOutside: true,
                        timer: 3000
                    });
                    setTimeout(window.location.reload(), 3000);
                }
            });
        }
    </script>

    <script>
        function previewData(id) {
            // $('#myModal2').modal('show');
            $.ajax({
                type: 'GET',
                xhrFields:{
                    responseType: 'blob'
                },
                url: '/dir/' + id,
                success: function (data) {

                    $.ajax({
                        type: 'GET',
                        url: '/direct/' + id,
                        success: function (hasil) {
                            if (hasil == "pdf") {
                                var blob = new Blob([data], {type: 'application/pdf'});
                                var src = URL.createObjectURL(blob);
                                window.open(src)
                            } else {
                                var blob = new Blob([data], {type: 'image/png'});
                                var src = URL.createObjectURL(blob);
                                window.open(src)
                            }
                        }
                    });
                }
            });
        }
    </script>

    <script>
        function sendData(id) {

            $.ajax({
                type: 'GET',
                url: '/doc/' + id,
                success: function (data) {

                    $.ajax({
                        type: 'POST',
                        url: 'https://dcktrp.jakarta.go.id/sikat/api/update-ocr?key=d1cde049046763854eb8bd838479b33a5b5df8316ddfcbac2cd7779ee644aceb4f5712875a1c56ef81d92c2be9fc3da893de228b134c23257b2597b779bffab6',
                        crossDomain: true,
                        dataType: 'json',
                        data: {
                            "ocr" : data.result,
                            "file_name" : data.docName
                        },
                        success: function (response) {
                            if (response.status == true) {
                            $.ajax({
                                type: 'GET',
                                url: '/sent/' + id,
                                success: function (data) {
                                    swal({
                                        title: "Sent!",
                                        text: response.message,
                                        type: "success",
                                        buttons: false,
                                        closeOnClickOutside: false,
                                        timer: 3000
                                    });
                                    setTimeout(window.location.reload(), 3000);
                                }
                            });

                            } else {
                                swal({
                                    title: "Failed!",
                                    text: response.message,
                                    type: "success",
                                    buttons: true,
                                    closeOnClickOutside: true,
                                    timer: 3000
                                });
                            }
                        },
                        error: function (response) {
                            swal({
                                title: "Failed!",
                                text: "Gagal kirim data",
                                type: "success",
                                buttons: false,
                                closeOnClickOutside: false,
                                timer: 3000
                            });
                        }
                    });

                    swal({
                        title: "Loading...",
                        text: "Please wait...",
                        type: "success",
                        buttons: false,
                        closeOnClickOutside: false
                    });
                }
            });
        }
    </script>

	<script>
            if ($.fn.DataTable.isDataTable('#tabelku')) {
                //table yg sudah dibentuk menjadi datatable harus d rebuild lagi untuk di instantiasi ulang
                $('#tabelku').DataTable().clear();
                $('#tabelku').DataTable().destroy();
            }
            $.ajax({
                type: 'GET',
                url: '/get',
                success: function (datatable) {
                    $('#tabelku').DataTable({
                        data: datatable,
                        "columns": [
                            {
                                title: "Preview",
                                data: null,
                                render: function (data, type, row) {
                                        return "<button class='btn-primary' onclick=previewData('" + data.id + "') >Preview</button>"
                                    }
                            },
                            {
                                title: "Nama File",
                                data: 'docName'
                            },
                            {
                                title: "Status",
                                data: 'success',
                                render: function (data, type, row) {
                                    if (data == "SUCCEED") {
                                        return "<button class='btn-success' disabled>SUKSES</button>"
                                    } else {
                                        return "<button class='btn-danger' disabled>GAGAL</button>"
                                    }
                                }
                            },
                            {
                                title: "Action",
                                data: null,
                                render: function (data, type, row) {
                                    if(data.sent == true) {
                                        return "<button class='btn-primary' onclick=lihatData('" + data.id + "') >Lihat Data</button>" +
                                            "<button class='btn-default' onclick=fixData('" + data.id + "') >Perhalus Data</button>" +
                                            "<button class='btn-warning' onclick=sendData('" + data.id + "') disabled >Terkirim!</button>" +
                                            "<button class='btn-danger' onclick=deleteData('" + data.id + "') >Hapus</button>"
                                    } else {
                                        return "<button class='btn-primary' onclick=lihatData('" + data.id + "') >Lihat Data</button>" +
                                            "<button class='btn-default' onclick=fixData('" + data.id + "') >Perhalus Data</button>" +
                                            "<button class='btn-warning' onclick=sendData('" + data.id + "') >Kirim Data</button>" +
                                            "<button class='btn-danger' onclick=deleteData('" + data.id + "') >Hapus</button>"
                                    }

                                }
                            }
                        ]
                    });
                }
            });
	</script>

</body>
</html>
